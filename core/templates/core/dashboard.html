{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">

  <!-- Top Bar - "Hi, user" and optionally quick links (mimicking top-left text from your screenshot) -->
  <div class="row mb-4">
    <div class="col d-flex align-items-center">
      <h4 class="me-4">Hi, {{ user.username|default:"User" }}</h4>
      <!-- Example: Additional inline items or navigation tabs -->
      <!--
      <nav>
        <ul class="nav">
          <li class="nav-item"><a href="#" class="nav-link">Finance</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Tasks</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Onboarding</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Knowledge Base</a></li>
        </ul>
      </nav>
      -->
    </div>
  </div>

  <!-- Row for “Income & Expense” bar chart and pie chart for expenses -->
  <div class="row mb-4">
    <!-- Bar Chart: Income & Expense -->
    <div class="col-md-8 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Income &amp; Expense</h5>
          <canvas id="incomeExpenseChart" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Pie Chart: Expenses by Category -->
    <div class="col-md-4 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Expenses {{ current_month_year|default:"July 2022" }}</h5>
          <h6 class="text-muted">{{ expenses|default:"272,200" }} $</h6>
          <canvas id="expensesPieChart" height="200"></canvas>
          <!-- Legend or breakdown can be appended here if needed -->
        </div>
      </div>
    </div>
  </div>

  <!-- Row for “Account Balance” line chart and additional pie (revenue breakdown, etc.) -->
  <div class="row mb-4">
    <!-- Account Balance (Line Chart) -->
    <div class="col-md-8 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Account Balance</h5>
          <canvas id="accountBalanceChart" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Another Pie Chart (Revenue or category breakdown) -->
    <div class="col-md-4 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Revenue {{ current_month_year|default:"July 2022" }}</h5>
          <h6 class="text-muted">{{ income|default:"389,000" }} $</h6>
          <canvas id="revenuePieChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary / Quick Stats -->
  <div class="row mb-4">
    <div class="col">
      <div class="card p-3">
        <h5 class="card-title">Key Stats</h5>
        <p><strong>Total Income:</strong> ${{ income }}</p>
        <p><strong>Total Expenses:</strong> ${{ expenses }}</p>
        <p><strong>Net Worth:</strong> ${{ net_worth }}</p>
      </div>
    </div>
  </div>

  <!-- Spending by Category (simple list or table) -->
  <div class="row mb-4">
    <div class="col">
      <div class="card p-3">
        <h5>Spending by Category</h5>
        <ul>
          {% for category, total in category_breakdown %}
          <li>{{ category }}: ${{ total }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col">
      <div class="card p-3">
        <h5>Quick Actions</h5>
        <a href="{% url 'create_transaction' %}" class="btn btn-primary me-2 mb-2">New Transaction</a>
        <a href="{% url 'add_category' %}" class="btn btn-secondary me-2 mb-2">Add Category</a>
        <a href="{% url 'set_budget' %}" class="btn btn-secondary me-2 mb-2">Set Budget</a>
        <a href="{% url 'reports' %}" class="btn btn-secondary mb-2">Reports</a>
      </div>
    </div>
  </div>

</div> <!-- /.container-fluid -->

<!-- Include Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
<script>
  // ----------------------------------
  // Income & Expense (Bar + Line) Chart
  // ----------------------------------
  const ctxIncomeExpense = document.getElementById('incomeExpenseChart').getContext('2d');
  const incomeExpenseChart = new Chart(ctxIncomeExpense, {
    type: 'bar',
    data: {
      labels: ['01/2022','02/2022','03/2022','04/2022','05/2022','06/2022','07/2022','08/2022','09/2022','10/2022','11/2022','12/2022'],
      datasets: [
        {
          label: 'Income',
          data: [10, 12, 15, 20, 18, 22, 25, 24, 30, 28, 35, 40],
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        },
        {
          label: 'Expense',
          data: [8, 9, 10, 15, 16, 18, 20, 22, 25, 26, 30, 32],
          backgroundColor: 'rgba(255, 99, 132, 0.6)',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 1
        },
        {
          // Example line overlay for Balance
          label: 'Balance',
          type: 'line',
          data: [2, 3, 5, 5, 2, 4, 5, 2, 5, 2, 5, 8],
          borderColor: 'rgba(54, 162, 235, 1)',
          fill: false,
          tension: 0.1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // ------------------------
  // Expenses Pie Chart
  // ------------------------
  const ctxExpensesPie = document.getElementById('expensesPieChart').getContext('2d');
  const expensesPieChart = new Chart(ctxExpensesPie, {
    type: 'pie',
    data: {
      labels: ['Salary','Equipment','Business trips','Rent','Advertising','Internet','Communication'],
      datasets: [
        {
          data: [25, 10, 8, 15, 12, 18, 12],
          backgroundColor: [
            '#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#FF6384'
          ]
        }
      ]
    },
    options: {
      responsive: true
    }
  });

  // ------------------------
  // Account Balance (Line) Chart
  // ------------------------
  const ctxAccountBalance = document.getElementById('accountBalanceChart').getContext('2d');
  const accountBalanceChart = new Chart(ctxAccountBalance, {
    type: 'line',
    data: {
      labels: ['01/2022','02/2022','03/2022','04/2022','05/2022','06/2022','07/2022','08/2022'],
      datasets: [
        {
          label: 'Checking',
          data: [1000, 1200, 1400, 1300, 1500, 1700, 1900, 2100],
          borderColor: 'rgba(255, 99, 132, 1)',
          fill: false
        },
        {
          label: 'Savings',
          data: [3000, 3200, 3400, 3600, 3800, 4000, 4200, 4500],
          borderColor: 'rgba(75, 192, 192, 1)',
          fill: false
        },
        {
          label: 'Investments',
          data: [5000, 5200, 5400, 5600, 5700, 5900, 6000, 6200],
          borderColor: 'rgba(255, 206, 86, 1)',
          fill: false
        }
      ]
    },
    options: {
      responsive: true
    }
  });

  // ------------------------
  // Revenue Pie Chart
  // ------------------------
  const ctxRevenuePie = document.getElementById('revenuePieChart').getContext('2d');
  const revenuePieChart = new Chart(ctxRevenuePie, {
    type: 'pie',
    data: {
      labels: ['SEO','Website Dev','Social Media','Email Marketing','Analytics'],
      datasets: [
        {
          data: [20, 25, 15, 25, 15],
          backgroundColor: [
            '#36A2EB','#FF6384','#FFCE56','#4BC0C0','#9966FF'
          ]
        }
      ]
    },
    options: {
      responsive: true
    }
  });
</script>
{% endblock %}
