{% extends 'core/base.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">

  <!-- Top Bar: Greeting -->
  <div class="row mb-4">
  <div class="col d-flex justify-content-between align-items-center">
    <h4>Hi, {{ user.username|default:"User" }}</h4>
    <div class="dropdown">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="actionDropdownTop"
              data-bs-toggle="dropdown" aria-expanded="false">
        Actions
      </button>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="actionDropdownTop">
        <li><a class="dropdown-item" href="{% url 'create_transaction' %}">New Transaction</a></li>
        <li><a class="dropdown-item" href="{% url 'add_category' %}">Add Category</a></li>
        <li><a class="dropdown-item" href="{% url 'set_budget' %}">Set Budget</a></li>
        <li><a class="dropdown-item" href="{% url 'reports' %}">Reports</a></li>
        <li><a class="dropdown-item" href="{% url 'savings_goal' %}">Manage Savings</a></li>
      </ul>
    </div>
  </div>
</div>

  <!-- Row with charts and moved Actions dropdown -->
  <div class="row mb-4">
    <!-- Income & Expense Chart with Actions dropdown -->
    <div class="col-md-8 mb-3">
      <div class="card">
        <div class="card-body">
            <h5 class="mb-0">Income &amp; Expense</h5>
          <canvas id="incomeExpenseChart" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Expenses Pie Chart -->
    <div class="col-md-4 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Expenses {{ current_month_year|default:"July 2022" }}</h5>
          <h6 class="text-muted">{{ expenses|default:"272,200" }} $</h6>
          <canvas id="expensesPieChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional charts and stats remain unchanged -->
  <div class="row mb-4">
    <!-- Account Balance (Line Chart) -->
    <div class="col-md-8 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Account Balance</h5>
          <canvas id="accountBalanceChart" height="100"></canvas>
        </div>
      </div>
    </div>

    <!-- Revenue Pie Chart -->
    <div class="col-md-4 mb-3">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Revenue {{ current_month_year|default:"July 2022" }}</h5>
          <h6 class="text-muted">{{ income|default:"389,000" }} $</h6>
          <canvas id="revenuePieChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Key Stats -->
  <div class="row mb-4">
    <div class="col">
      <div class="card p-3">
        <h5 class="card-title">Key Stats</h5>
        <p><strong>Total Income:</strong> ${{ income }}</p>
        <p><strong>Total Expenses:</strong> ${{ expenses }}</p>
        <p><strong>Net Worth:</strong> ${{ net_worth }}</p>
      </div>
    </div>
  </div>

  <!-- Spending by Category -->
  <div class="row mb-4">
    <div class="col">
      <div class="card p-3">
        <h5>Spending by Category</h5>
        <ul>
          {% for category, total in category_breakdown %}
          <li>{{ category }}: ${{ total }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js CDN and scripts (same as before) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
<script>
  // ----------------------------------
  // Income & Expense (Bar + Line) Chart
  // ----------------------------------
  const ctxIncomeExpense = document.getElementById('incomeExpenseChart').getContext('2d');
  const incomeExpenseChart = new Chart(ctxIncomeExpense, {
    type: 'bar',
    data: {
      labels: ['01/2022','02/2022','03/2022','04/2022','05/2022','06/2022','07/2022','08/2022','09/2022','10/2022','11/2022','12/2022'],
      datasets: [
        {
          label: 'Income',
          data: [10, 12, 15, 20, 18, 22, 25, 24, 30, 28, 35, 40],
          backgroundColor: 'rgb(6,167,125, .8)',
          borderColor: 'rgb(6,167,125, .6)',
          borderWidth: 1
        },
        {
          label: 'Expense',
          data: [8, 9, 10, 15, 16, 18, 20, 22, 25, 26, 30, 32],
          backgroundColor: 'rgb(239,121,138, .8)',
          borderColor: 'rgb(239,121,138)',
          borderWidth: 1
        },
        {
          // Example line overlay for Balance
          label: 'Balance',
          type: 'line',
          data: [2, 3, 5, 5, 2, 4, 5, 2, 5, 2, 5, 8],
          borderColor: 'rgba(54, 162, 235, 1)',
          fill: false,
          tension: 0.1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // ------------------------
  // Expenses Pie Chart
  // ------------------------
  const ctxExpensesPie = document.getElementById('expensesPieChart').getContext('2d');
  const expensesPieChart = new Chart(ctxExpensesPie, {
    type: 'pie',
    data: {
      labels: ['Salary','Equipment','Business trips','Rent','Advertising','Internet','Communication'],
      datasets: [
        {
          data: [25, 10, 8, 15, 12, 18, 12],
          backgroundColor: [
            '#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#FF6384'
          ]
        }
      ]
    },
    options: {
      responsive: true
    }
  });

  // ------------------------
  // Account Balance (Line) Chart
  // ------------------------
  const ctxAccountBalance = document.getElementById('accountBalanceChart').getContext('2d');
  const accountBalanceChart = new Chart(ctxAccountBalance, {
    type: 'line',
    data: {
      labels: ['01/2022','02/2022','03/2022','04/2022','05/2022','06/2022','07/2022','08/2022'],
      datasets: [
        {
          label: 'Checking',
          data: [1000, 1200, 1400, 1300, 1500, 1700, 1900, 2100],
          backgroundColor: 'rgba(255, 99, 132, 1)',
            borderColor: 'rgba(255, 99, 132, 1)',
          fill: false
        },
        {
          label: 'Savings',
          data: [3000, 3200, 3400, 3600, 3800, 4000, 4200, 4500],
          backgroundColor: 'rgba(75, 192, 192, 1)',
            borderColor: 'rgba(75, 192, 192, 1)',
          fill: false
        },
        {
          label: 'Investments',
          data: [5000, 5200, 5400, 5600, 5700, 5900, 6000, 6200],
          backgroundColor: 'rgba(255, 166, 48, 1)',
            borderColor: 'rgba(255, 166, 48, 1)',
          fill: false
        }
      ]
    },
    options: {
      responsive: true
    }
  });

  // ------------------------
  // Revenue Pie Chart
  // ------------------------
  const ctxRevenuePie = document.getElementById('revenuePieChart').getContext('2d');
  const revenuePieChart = new Chart(ctxRevenuePie, {
    type: 'pie',
    data: {
      labels: ['SEO','Website Dev','Social Media','Email Marketing','Analytics'],
      datasets: [
        {
          data: [20, 25, 15, 25, 15],
          backgroundColor: [
            '#ffa630','#df3b57','#3ab795','#4BC0C0','#0a60db'
          ]
        }
      ]
    },
    options: {
      responsive: true
    }
  });
</script>

</script>
{% endblock %}
